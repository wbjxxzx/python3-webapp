{% extends '__base__.html' %}

{% block title %}注册{% endblock %}

{% block beforehead %}
<script>
    function validateEmail(email){
        var re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9-_]+\.[a-zA-Z0-9-_]{1,3}$/;
        return re.test(email);
    }
    $(function(){
        var vm = new Vue({
            el: '#vm',
            data: {
                name: '',
                email: '',
                password1: '',
                password2: '',
            },
            methods: {
                submit: function(event){
                    event.preventDefault();
                    var $form = $('#vm');
                    if(! this.name.trim()){
                        return $form.showFormError('请输入姓名');
                    }
                    if(! validateEmail(this.email.trim())){
                        return $form.showFormError('请输入正确的email');
                    }
                    if(this.password1.length < 8){
                        return $form.showFormError('口令长度至少为8个字符');
                    }
                    if(this.password1 !== this.password2){
                        return $form.showFormError('两次输入的口令不一致');
                    }
                    var email = this.email.trim();
                    $form.postJSON('/api/users', {
                        name: this.name.trim(),
                        email: email,
                        passwd: CryptoJS.SHA1(email + ':' + this.password1).toString()
                    }, function(err, r){
                        if(err){
                            return $form.showFormError(err);
                        }
                        return location.assign('/');
                    })
                }
            }
        });
        $('#vm').show();
    })
</script>
{% endblock %}

{% block content %}
<div class="">
    <h1>欢迎注册</h1>
    <form id="vm" v-on="submit:submit" class="form-control">
        <div class="input-group">
            <label for="username" class="form-control" >姓名</label>
            <input  v-model="name" type="text" id="username" class="form-control" placeholder="username" />
        </div>
        <div class="input-group">
            <label for="email" class="form-control">email</label>
            <input v-model="email" type="text" id="email" class="form-control" placeholder="example@example.com" />
        </div>
        <div class="input-group">
            <label for="email" class="form-control">口令</label>
            <input v-model="password1" type="password1" maxlength="50" class="form-control" placeholder="example@example.com" />
        </div>
        <div class="input-group">
            <label for="email" class="form-control">口令</label>
            <input v-model="password1" type="password1" maxlength="50" class="form-control" placeholder="example@example.com" />
        </div>
        <div class="input-group">
            <button type="submit"><i class=""></i>注册</button>
        </div>
    </form>
</div>
{% endblock %}