{% extends '__base__.html' %}

{% block title %}编辑日志{% endblock %}

{% block beforehead %}
<script>
    var ID = '{{ id }}',
        action = '{{ action }}';
    function initVM(blog){
        var vm = new Vue({
            el: '#vm',
            data: blog,
            methods: {
                submit: function(event){
                    event.preventDefault();
                    var $form = $('#vm').find('form');
                    $form.postJSON(action, this.$data, function(err,r){
                        if(err){
                            $form.showFormError(err);
                        }
                        else {
                            return location.assign('/api/blogs/' + r.id);
                        }
                    });
                }
            }
        });
        $('#vm').show();
    }
    $(function(){
        if(ID){
            getJSON('/api/blogs/' + ID, function(err, blog){
                if(err){
                    return fatal(err);
                }
                $('#loading').hide();
                initVM(blog);
            });
        }
        else {
            $('#loading').hide();
            initVM({
                name: '',
                summary: '',
                content: '',
            });
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="">
    <div id="error">

    </div>
    <div id="loading">
        <span><i class=""></i>loading</span>
    </div>

    <div id="vm" class="">
        <form v-on="submit:submit" class="form-horizontal">
            <div class="form-group">
                <label class="control-label">标题：</label>
                <div class="">
                    <input v-model="name" name="name" type="text" placeholder="标题" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label">摘要：</label>
                <div class="">
                    <textarea v-model="summary" rows="4" name="summary" placeholder="摘要" class="form-control"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label">内容：</label>
                <div class="">
                    <textarea v-model="content" rows="16" name="content" placeholder="内容" class="form-control"></textarea>
                </div>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-success"><i class="glyphicon glyphicon-ok">保存</i></button>
                <a href="/manage/blogs" class="btn btn-danger"><i class="glyphicon glyphicon-remove"></i>取消</a>
            </div>
        </form>
    </div>
</div>


{% endblock %}